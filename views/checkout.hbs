<!--banner-->
<div class="banner-top">
    <div class="container">
        <h2 class="animated wow fadeInLeft" data-wow-delay=".5s">Checkout</h2>
        <h3 class="animated wow fadeInRight" data-wow-delay=".5s"><a href="/">Home</a><label>/</label>Checkout
        </h3>
        <div class="clearfix"> </div>
    </div>
</div>
<!-- contact -->
<div class="check-out">
    <div class="container">

        <script>$(document).ready(function (c) {
                $('.close1').on('click', function (c) {
                    $('.cross').fadeOut('slow', function (c) {
                        $('.cross').remove();
                    });
                });
            });
        </script>
        <script>$(document).ready(function (c) {
                $('.close2').on('click', function (c) {
                    $('.cross1').fadeOut('slow', function (c) {
                        $('.cross1').remove();
                    });
                });
            });
        </script>
        <script>$(document).ready(function (c) {
                $('.close3').on('click', function (c) {
                    $('.cross2').fadeOut('slow', function (c) {
                        $('.cross2').remove();
                    });
                });
            });
        </script>
        <table class="table animated wow fadeInLeft" data-wow-delay=".5s" id="cart-items">
            <tr>
                <th class="t-head head-it ">Item</th>
                <th class="t-head">Price</th>
                <th class="t-head">Quantity</th>
                <th class="t-head">Total</th>
            </tr>

        </table>
        <div class="cart-total">

            <h5 class="continue">Cart Total</h5>
            <div class="price-details">
                <h3>Price Details</h3>
                <span>Total</span>
                <span class="total1 order-total"></span>
                <span>Discount</span>
                <span class="total1">0.00</span>
                {{!-- <span>Delivery Charges</span> --}}
                <span class="total1 order total"></span>
                <div class="clearfix"></div>
            </div>
            <ul class="total_price">
                <li class="last_price">
                    <h4>TOTAL</h4>
                </li>
                <li class="last_price"><span class="order-total"></span></li>
                <div class="clearfix"> </div>
            </ul>

            <button onclick="checkout()" class="btn btn-warning">Checkout and Pay</button>
        </div>

    </div>


</div>
</div>

<script>
    const orderItemTemplate = (orderItem, shopId) => {
        return `
            <tr>
                <td class="ring-in t-data">
                    <a href="/product-details?productId=${orderItem.productId}&shopId=${shopId}" class="at-in">
                        <img src="${orderItem.productImage}" class="img-responsive kev-img" alt="">
                    </a>
                    <div class="sed">
                        <h5>${orderItem.productName}</h5>
                    </div>
                    <div class="clearfix"> </div>
                    <div onclick="removeItem(${orderItem.productId})" class="close1"> </div>
                </td>
                <td class="t-data">KES ${orderItem.productPrice}</td>
                <td class="t-data">
                    <div class="quantity">
                        <span style="visibility: hidden" class="product-id">${orderItem.productId}</div>
                            
                        <div class="quantity-select">
                            <div class="entry value-minus">&nbsp;</div>
                            <div class="entry value"><span class="span-1">${orderItem.quantity}</span></div>
                            <div class="entry value-plus active">&nbsp;</div>
                        </div>
                    </div>

                </td>
                <td class="t-data">KES ${orderItem.total}</td>

            </tr>
        `;
    };

    const order = JSON.parse(localStorage.getItem('order'));
    if (order && order.orderItems) {
        order.orderItems.forEach(item => {
            $('#cart-items').append(orderItemTemplate(item, order.shopId));
        });
    }

    const removeItem = (productId) => {
        console.log(productId);
        updateCart(productId, 'remove');
        location.href = location.href;
    };

    const checkout = async () => {
        try {
            const order = JSON.parse(localStorage.getItem('order'));
            if (order && order.orderItems && order.orderItems.length) {
                if (confirm('Simulating payment.......Do you want to continue?')) {
                    const order = JSON.parse(localStorage.getItem('order'));
                    const res = await axios.post('orders', order);
                    emptyCart();
                    alert('Order has been placed successfully');
                    location.href = 'customer-orders';
                }
            }
        } catch (e) {
            alert('Could not place order. Please try again.');
            throw e;
        }
    };
</script>

<!--quantity-->
<script>
    $('.value-plus').on('click', function () {
        var divUpd = $(this).parent().find('.value'),
            productId = $(this).parent().parent().find('.product-id').text(),
            newVal = parseInt(divUpd.text(), 10) + 1;
        updateCart(productId, 'increment');
        divUpd.text(newVal);
        location.href = location.href;
    });

    $('.value-minus').on('click', function () {
        var divUpd = $(this).parent().find('.value'),
            productId = $(this).parent().parent().find('.product-id').text(),
            newVal = parseInt(divUpd.text(), 10) - 1;
        if (newVal >= 1) {
            updateCart(productId, 'decrement');
            divUpd.text(newVal);
            location.href = location.href;
        }
    });
</script>
<!--quantity-->